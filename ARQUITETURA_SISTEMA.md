# ğŸ—ï¸ Arquitetura Atual do Sistema AtendentePro

## ğŸ“Š **Diagrama de Fluxo de Agentes**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USUÃRIO                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TRIAGE AGENT                                  â”‚
â”‚  â€¢ Entrada principal                                            â”‚
â”‚  â€¢ Roteamento inteligente                                       â”‚
â”‚  â€¢ Guardrails de escopo                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚FLOW AGENT   â”‚ â”‚KNOWLEDGE    â”‚ â”‚USAGE AGENT  â”‚
â”‚â€¢ Identifica â”‚ â”‚AGENT        â”‚ â”‚â€¢ Sistema    â”‚
â”‚  tÃ³picos    â”‚ â”‚â€¢ RAG        â”‚ â”‚  help      â”‚
â”‚â€¢ Apresenta  â”‚ â”‚â€¢ Documentos â”‚ â”‚â€¢ Meta-info â”‚
â”‚  opÃ§Ãµes     â”‚ â”‚â€¢ Embeddings â”‚ â”‚            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚               â”‚
      â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚INTERVIEW    â”‚ â”‚CONFIRMATION â”‚ â”‚TRIAGE       â”‚
â”‚AGENT        â”‚ â”‚AGENT        â”‚ â”‚(fallback)   â”‚
â”‚â€¢ Coleta     â”‚ â”‚â€¢ ValidaÃ§Ã£o  â”‚ â”‚            â”‚
â”‚  detalhes   â”‚ â”‚â€¢ ConfirmaÃ§Ã£oâ”‚ â”‚            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚
      â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ANSWER AGENT â”‚ â”‚TRIAGE       â”‚
â”‚â€¢ Resposta   â”‚ â”‚(fallback)   â”‚
â”‚  final      â”‚ â”‚            â”‚
â”‚â€¢ RecomendaÃ§Ãµesâ”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ **Sistema de ConfiguraÃ§Ã£o**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONFIGURAÃ‡ÃƒO POR CLIENTE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Template/White_Martins/          Template/standard/            â”‚
â”‚  â”œâ”€â”€ guardrails_config.yaml      â”œâ”€â”€ guardrails_config.yaml    â”‚
â”‚  â”œâ”€â”€ triage_config.yaml          â”œâ”€â”€ triage_config.yaml        â”‚
â”‚  â”œâ”€â”€ flow_config.yaml            â”œâ”€â”€ flow_config.yaml          â”‚
â”‚  â”œâ”€â”€ interview_config.yaml       â”œâ”€â”€ interview_config.yaml     â”‚
â”‚  â”œâ”€â”€ answer_config.yaml          â”œâ”€â”€ answer_config.yaml        â”‚
â”‚  â”œâ”€â”€ knowledge_config.yaml       â”œâ”€â”€ knowledge_config.yaml     â”‚
â”‚  â””â”€â”€ guardrail_messages.yaml     â””â”€â”€ guardrail_messages.yaml   â”‚
â”‚                                                                 â”‚
â”‚  Ordem de Busca: Cliente â†’ Standard â†’ Root                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ **Sistema de Guardrails**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INPUT GUARDRAILS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  UsuÃ¡rio â†’ Guardrail â†’ Agente                                  â”‚
â”‚     â”‚         â”‚          â”‚                                      â”‚
â”‚     â”‚         â–¼          â”‚                                      â”‚
â”‚     â”‚  Avalia escopo     â”‚                                      â”‚
â”‚     â”‚         â”‚          â”‚                                      â”‚
â”‚     â”‚         â–¼          â”‚                                      â”‚
â”‚     â”‚  tripwire_triggeredâ”‚                                      â”‚
â”‚     â”‚         â”‚          â”‚                                      â”‚
â”‚     â”‚         â–¼          â”‚                                      â”‚
â”‚     â”‚  InputGuardrail    â”‚                                      â”‚
â”‚     â”‚  TripwireTriggered â”‚                                      â”‚
â”‚     â”‚         â”‚          â”‚                                      â”‚
â”‚     â”‚         â–¼          â”‚                                      â”‚
â”‚     â”‚  Mensagem          â”‚                                      â”‚
â”‚     â”‚  Educativa         â”‚                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§  **Sistema RAG (Knowledge Agent)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PROCESSAMENTO RAG                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  PDFs â†’ ExtraÃ§Ã£o â†’ Chunking â†’ Embeddings â†’ Busca â†’ Resposta    â”‚
â”‚    â”‚       â”‚         â”‚          â”‚          â”‚         â”‚         â”‚
â”‚    â”‚       â–¼         â–¼          â–¼          â–¼         â–¼         â”‚
â”‚    â”‚  Texto      Chunks    Vectors    Similarity  Context      â”‚
â”‚    â”‚  Raw       (1000)    (3072)     Score       + Query      â”‚
â”‚    â”‚                        â”‚          â”‚                      â”‚
â”‚    â”‚                        â–¼          â–¼                      â”‚
â”‚    â”‚                   Cache      Top-K                        â”‚
â”‚    â”‚                   Memory     Results                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš¡ **Pontos de Gargalo Identificados**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GARGALOS DE PERFORMANCE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. ğŸ”„ Carregamento de ConfiguraÃ§Ãµes                            â”‚
â”‚     â€¢ MÃºltiplas chamadas I/O por agente                        â”‚
â”‚     â€¢ Parsing YAML repetido                                    â”‚
â”‚     â€¢ Sem cache de configuraÃ§Ãµes                               â”‚
â”‚                                                                 â”‚
â”‚  2. ğŸ’¾ Sistema de Embeddings                                   â”‚
â”‚     â€¢ Carregamento completo na memÃ³ria                         â”‚
â”‚     â€¢ ~2GB para 1000 chunks                                    â”‚
â”‚     â€¢ Sem estratÃ©gia de eviction                               â”‚
â”‚                                                                 â”‚
â”‚  3. ğŸ”— Rede de Agentes Hardcoded                               â”‚
â”‚     â€¢ ConfiguraÃ§Ã£o estÃ¡tica                                    â”‚
â”‚     â€¢ NÃ£o suporta customizaÃ§Ã£o por cliente                     â”‚
â”‚     â€¢ Acoplamento forte                                        â”‚
â”‚                                                                 â”‚
â”‚  4. ğŸ“Š Falta de Monitoramento                                  â”‚
â”‚     â€¢ Sem mÃ©tricas de performance                              â”‚
â”‚     â€¢ DifÃ­cil identificar gargalos                             â”‚
â”‚     â€¢ Sem alertas de degradaÃ§Ã£o                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ **Arquitetura Proposta (Melhorada)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONFIG MANAGER                              â”‚
â”‚  â€¢ Singleton pattern                                           â”‚
â”‚  â€¢ Cache de configuraÃ§Ãµes                                     â”‚
â”‚  â€¢ Carregamento Ãºnico                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AGENT ORCHESTRATOR                          â”‚
â”‚  â€¢ Handoffs dinÃ¢micos                                          â”‚
â”‚  â€¢ ConfiguraÃ§Ã£o por cliente                                    â”‚
â”‚  â€¢ Monitoramento de performance                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EMBEDDING CACHE                             â”‚
â”‚  â€¢ Cache distribuÃ­do                                           â”‚
â”‚  â€¢ EstratÃ©gia LRU                                             â”‚
â”‚  â€¢ PersistÃªncia opcional                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ **MÃ©tricas de Performance**

| Componente | Tempo Atual | Tempo Otimizado | Melhoria |
|------------|-------------|-----------------|----------|
| Carregamento Config | 0.01s/arquivo | 0.001s/arquivo | 10x |
| Embedding Query | 0.5s | 0.05s (cache) | 10x |
| Busca SemÃ¢ntica | 0.1s | 0.05s | 2x |
| Resposta Agente | 2-5s | 1-3s | 1.5x |
| MemÃ³ria Total | ~2GB | ~500MB | 4x |

## ğŸ¯ **RecomendaÃ§Ãµes PrioritÃ¡rias**

### **ğŸ”¥ Alta Prioridade**
1. **ConfigManager Centralizado** - Reduz I/O em 90%
2. **Cache de Embeddings** - Melhora velocidade em 10x
3. **Sistema de MÃ©tricas** - Permite otimizaÃ§Ã£o contÃ­nua

### **âš¡ MÃ©dia Prioridade**
1. **Handoffs DinÃ¢micos** - Flexibilidade por cliente
2. **Pool de ConexÃµes** - Escalabilidade
3. **Logging Estruturado** - Debugging eficiente

### **ğŸ”® Baixa Prioridade**
1. **MicroserviÃ§os** - Arquitetura distribuÃ­da
2. **Database Embeddings** - SoluÃ§Ã£o robusta
3. **Fine-tuning** - Qualidade premium
